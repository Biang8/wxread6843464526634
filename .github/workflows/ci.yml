name: Weekly Log Cleanup

on:
  # å®šæ—¶ä»»åŠ¡è§¦å‘æ¡ä»¶ï¼Œæ¯å‘¨æ—¥åŒ—äº¬æ—¶é—´ 24 ç‚¹ï¼ˆå³å‘¨ä¸€ 00:00ï¼Œå¯¹åº” UTC æ—¶é—´å‘¨æ—¥ 16:00ï¼‰æ‰§è¡Œ
  schedule:
    - cron: '0 16 * * sun'
  # æ‰‹åŠ¨è§¦å‘æ¡ä»¶
  workflow_dispatch:
    description: æ‰‹åŠ¨è§¦å‘æ—¥å¿—æ¸…ç†ä»»åŠ¡

jobs:
  cleanup_log:
    runs-on: ubuntu-22.04
    permissions:
      contents: write  # å…³é”®æƒé™å£°æ˜ï¼Œç”¨äºæäº¤æ–‡ä»¶ä¿®æ”¹

    steps:
      - name: ğŸ“¥ æ£€å‡ºä»“åº“
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ—‘ï¸ æ¸…ç†æ—¥å¿—æ–‡ä»¶
        run: |
          echo "ğŸ§¹ å¼€å§‹æ¸…ç† log.md æ–‡ä»¶ï¼Œè®©å®ƒæ¢å¤å¹²å‡€æ•´æ´ï¼"
          > log.md
          echo "ğŸ‰ log.md æ–‡ä»¶å·²æˆåŠŸæ¸…ç©ºï¼Œä»¿ä½›ç„•ç„¶ä¸€æ–°ï¼"

      - name: ğŸ“¤ æäº¤ log.md
        run: |
          # ä½¿ç”¨åŠ å¯†çš„ GitHub Secrets é…ç½®ç”¨æˆ·ä¿¡æ¯
          git config --global user.name ${{ secrets.USER_NAME }}
          git config --global user.email ${{ secrets.USER_EMAIL }}
          
          if git diff --quiet log.md; then
            echo "âœ… æ£€æŸ¥å‘ç° log.md æ²¡æœ‰å˜æ›´ï¼Œæ— éœ€æäº¤å•¦ã€‚"
          else
            echo "ğŸ“ log.md æœ‰æ›´æ–°ï¼Œå‡†å¤‡æäº¤åˆ°ä»“åº“ã€‚"
            git add log.md
            git commit -m "Weekly log cleanup: Empty log.md"
            git push
            echo "ğŸ‰ log.md æäº¤æˆåŠŸï¼Œä»“åº“å·²æ›´æ–°ï¼"
          fi
